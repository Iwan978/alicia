import { Jimp, getTestDir } from "@jimp/test-utils";
import configure from "@jimp/custom";
import { expect } from "chai";

const jimp = configure({ types: [".tiff"] }, Jimp);

describe.only("TIFF", () => {
  const imagesDir = getTestDir(__dirname) + "/images";

  it.only("load TIFF", async () => {
    const image = await jimp.read(imagesDir + "/rgb.tiff");

    expect(image.getPixelColor(10, 10)).to.equal(0xa4988bff);
    expect(image.getPixelColor(220, 190)).to.equal(0xe0d7ddff);
    expect(image.getPixelColor(350, 130)).to.equal(0x565433ff);
  });

  it.skip("export TIFF", async () => {
    const simpleJGD = {
      width: 3,
      height: 3,
      data: [
        0xff0000ff, 0xff0080ff, 0xff00ffff, 0xff0080ff, 0xff00ffff, 0x8000ffff,
        0xff00ffff, 0x8000ffff, 0x0000ffff,
      ],
    };

    const image = await jimp.read(simpleJGD);
    const buffer = await image.getBufferAsync("image/tiff");

    expect(buffer.toString()).to.match(/^MM\u0000*\u0000/);
  });
});
