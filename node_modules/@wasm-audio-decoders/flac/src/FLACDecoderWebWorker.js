import { WASMAudioDecoderWorker } from "@wasm-audio-decoders/common";
import EmscriptenWASM from "./EmscriptenWasm.js";
import FLACDecoder, { Decoder, DecoderOptions } from "./FLACDecoder.js";

class DecoderWorker extends WASMAudioDecoderWorker {
  constructor(options: DecoderOptions) {
    super(options, "flac-decoder", Decoder, EmscriptenWASM);
  }

  async decodeFrames(frames: ArrayBuffer): Promise<ArrayBuffer> {
    return this.postToDecoder("decodeFrames", frames);
  }
}

export default class FLACDecoderWebWorker extends FLACDecoder {
  constructor() {
    super();

    super.setDecoderClass(DecoderWorker);
  }

  async free(): Promise<void> {
    await super.free();
    this._decoder.terminate();
  }
}

